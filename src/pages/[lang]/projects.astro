---
import { getCollection } from 'astro:content';
import BaseLayout from "../../layouts/BaseLayout.astro";
import ProjectCard from "../../components/main/ProjectCard.astro";
import { t } from '@/utils/i18n';
import { languages } from "../../utils/languages";

export async function getStaticPaths() {
  return languages.map((lang) => ({
    params: { lang: lang.code },
  }));
}

const locale = Astro.params.lang || 'en';
const allProjects = await getCollection('projects');
const projects = allProjects
  .filter((project) => project.data.lang === locale)
  .sort((a, b) => {
    const orderA = a.data.order ?? 999;
    const orderB = b.data.order ?? 999;
    return orderA - orderB;
  });
---

<BaseLayout>
  <div class="projects-container">
    <h2 class="projects-title animate-fadeInUp">{t(locale, 'projects.title')}</h2>
    {projects.length === 0 ? (
      <p class="no-projects">{t(locale, 'projects.noProjects')}</p>
    ) : (
      <div class="projects-grid">
        {projects.map((project, index) => {
          const filename = project.id.split('/').pop();
          return (
            <ProjectCard
              title={project.data.title}
              image={project.data.image}
              url={`/${locale}/projects/${filename}`}
              animationDelay={(index + 1) * 0.1}
            />
          );
        })}
      </div>
    )}
  </div>
</BaseLayout>

<style>
  .projects-container {
    width: 100%;
  }

  .projects-title {
    font-size: 2rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 2rem;
  }

  .no-projects {
    text-align: center;
    color: var(--color-text-muted);
    padding: 3rem 1rem;
    font-size: 1.125rem;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .projects-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 2rem;
    }
  }

  @media (min-width: 1024px) {
    .projects-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
    }
  }
</style>

