---
---
<button class="theme-toggle" aria-label="Toggle theme">
  <svg class="sun-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="12" cy="12" r="5" fill="#FDB813"/>
    <g fill="#FDB813">
      <rect x="11" y="1" width="2" height="4" rx="1"/>
      <rect x="11" y="19" width="2" height="4" rx="1"/>
      <rect x="19" y="11" width="2" height="4" rx="1" transform="rotate(90 20 13)"/>
      <rect x="1" y="11" width="2" height="4" rx="1" transform="rotate(90 2 13)"/>
      <rect x="16.95" y="4.05" width="2" height="4" rx="1" transform="rotate(45 17.95 6.05)"/>
      <rect x="4.05" y="16.95" width="2" height="4" rx="1" transform="rotate(45 5.05 18.95)"/>
      <rect x="16.95" y="16.95" width="2" height="4" rx="1" transform="rotate(135 17.95 18.95)"/>
      <rect x="4.05" y="4.05" width="2" height="4" rx="1" transform="rotate(135 5.05 6.05)"/>
    </g>
  </svg>
  <svg class="moon-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="#818CF8"/>
  </svg>
</button>

<script>
  // Initialize theme from localStorage or system preference
  const getInitialTheme = () => {
    if (typeof localStorage !== 'undefined') {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) return savedTheme;
    }
    
    // Check system preference
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
      return 'light';
    }
    
    return 'dark';
  };

  const setTheme = (theme: string) => {
    if (theme === 'light') {
      document.documentElement.setAttribute('data-theme', 'light');
    } else {
      document.documentElement.removeAttribute('data-theme');
    }
    localStorage.setItem('theme', theme);
  };

  // Ripple animation function
  const createRippleAnimation = (event: MouseEvent) => {
    const x = event.clientX;
    const y = event.clientY;
    
    // Calculate the distance to the farthest corner
    const endRadius = Math.hypot(
      Math.max(x, window.innerWidth - x),
      Math.max(y, window.innerHeight - y)
    );

    // Check if View Transitions API is supported
    if (!document.startViewTransition) {
      // Fallback: just change theme without animation
      const currentTheme = localStorage.getItem('theme') || 'dark';
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
      return;
    }

    const currentTheme = localStorage.getItem('theme') || 'dark';
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

    // Create the transition
    const transition = document.startViewTransition(() => {
      setTheme(newTheme);
    });

    // Animate with a circular clip-path
    transition.ready.then(() => {
      const clipPath = [
        `circle(0px at ${x}px ${y}px)`,
        `circle(${endRadius}px at ${x}px ${y}px)`
      ];

      // Always animate the NEW theme expanding outward
      document.documentElement.animate(
        {
          clipPath: clipPath
        },
        {
          duration: 1000,
          easing: 'ease-in-out',
          pseudoElement: '::view-transition-new(root)'
        }
      );
    });
  };

  // Toggle theme on button click with animation
  const themeToggle = document.querySelector('.theme-toggle');
  if (themeToggle) {
    themeToggle.addEventListener('click', (e) => {
      createRippleAnimation(e as MouseEvent);
    });
  }

  // Listen for system theme changes
  if (window.matchMedia) {
    window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        setTheme(e.matches ? 'light' : 'dark');
      }
    });
  }
</script>

<style>
  .theme-toggle {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    background: transparent;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    padding: 0;
    transition: all 0.3s ease;
    overflow: hidden;
  }

  .theme-toggle:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: rotate(180deg) scale(1.1);
  }

  .theme-toggle:active {
    transform: scale(0.95);
  }

  .sun-icon,
  .moon-icon {
    position: absolute;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }

  /* Dark mode - show sun (to switch to light) */
  .sun-icon {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  .moon-icon {
    opacity: 0;
    transform: rotate(180deg) scale(0);
  }

  /* Light mode - show moon (to switch to dark) */
  :global([data-theme="light"]) .sun-icon {
    opacity: 0;
    transform: rotate(-180deg) scale(0);
  }

  :global([data-theme="light"]) .moon-icon {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  /* Hover effect - brighten icons */
  .theme-toggle:hover .sun-icon,
  .theme-toggle:hover .moon-icon {
    filter: drop-shadow(0 2px 8px rgba(253, 184, 19, 0.6));
  }

  :global([data-theme="light"]) .theme-toggle:hover .moon-icon {
    filter: drop-shadow(0 2px 8px rgba(129, 140, 248, 0.6));
  }
</style>